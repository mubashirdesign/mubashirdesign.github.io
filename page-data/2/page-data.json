{"componentChunkName":"component---src-templates-blog-js","path":"/2","result":{"data":{"markdownRemark":{"html":"<p>This guide assumes you have access to the Shopify script editor which comes with Shopify Plus.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dfd46a1ad8e153dc5f0cfdfc6f881640/db585/scripteditor.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.967674661105319%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAP0lEQVQI15WMQQ7AIAgE/f9jqY1VQISVmH7ATSZ7mimtM55PQU1A+bYcEXHN0AWqL4pOO5FpyR+7XjruARbBBuaZnh8mL0irAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Script Editor\"\n        title=\"Script Editor\"\n        src=\"/static/dfd46a1ad8e153dc5f0cfdfc6f881640/11d19/scripteditor.png\"\n        srcset=\"/static/dfd46a1ad8e153dc5f0cfdfc6f881640/40714/scripteditor.png 200w,\n/static/dfd46a1ad8e153dc5f0cfdfc6f881640/a8246/scripteditor.png 400w,\n/static/dfd46a1ad8e153dc5f0cfdfc6f881640/11d19/scripteditor.png 800w,\n/static/dfd46a1ad8e153dc5f0cfdfc6f881640/db585/scripteditor.png 959w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>First we'll initialize the customer in the ruby source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">customer <span class=\"token operator\">=</span> <span class=\"token constant\">Input</span><span class=\"token punctuation\">.</span>cart<span class=\"token punctuation\">.</span>customer</code></pre></div>\n<p>Then we'll want to make the function that applies the discount based on the passed parameter</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">applyDiscount</span></span> <span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> discountAmount<span class=\"token punctuation\">)</span></code></pre></div>\n<p>In the function we'll loop through each line item in the cart and apply the discount by multiplying the line item price by the discount amount</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">Input</span><span class=\"token punctuation\">.</span>cart<span class=\"token punctuation\">.</span>line_items<span class=\"token punctuation\">.</span><span class=\"token keyword\">each</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>line_item<span class=\"token operator\">|</span>\nline_item<span class=\"token punctuation\">.</span>change_line_price<span class=\"token punctuation\">(</span>line_item<span class=\"token punctuation\">.</span>line_price <span class=\"token operator\">*</span> discountAmount<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">:</span> <span class=\"token string\">\"<span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>message<span class=\"token delimiter tag\">}</span></span>\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>If we wanted the tag discount to only apply on certain products we can wrap the condition with an if statement</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token constant\">Input</span><span class=\"token punctuation\">.</span>cart<span class=\"token punctuation\">.</span>line_items<span class=\"token punctuation\">.</span><span class=\"token keyword\">each</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>line_item<span class=\"token operator\">|</span>\nproduct <span class=\"token operator\">=</span> line_item<span class=\"token punctuation\">.</span>variant<span class=\"token punctuation\">.</span>product<span class=\"token punctuation\">.</span>product_type\n<span class=\"token keyword\">if</span> product <span class=\"token operator\">==</span> <span class=\"token string\">\"Test\"</span>\nline_item<span class=\"token punctuation\">.</span>change_line_price<span class=\"token punctuation\">(</span>line_item<span class=\"token punctuation\">.</span>line_price <span class=\"token operator\">*</span> discountAmount<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">:</span> <span class=\"token string\">\"<span class=\"token interpolation\"><span class=\"token delimiter tag\">#{</span>message<span class=\"token delimiter tag\">}</span></span>\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>Now that the function is defined we'll need to determine with the customer is logged in</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">if</span> customer</code></pre></div>\n<p>Now we'll check for the specific tag that we are looking for</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">if</span> customer\n  <span class=\"token keyword\">if</span> customer<span class=\"token punctuation\">.</span>tags<span class=\"token punctuation\">.</span>include<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TestDiscount\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">#apply discount on TestDiscount tag for 50% on products</span>\n  applyDiscount <span class=\"token string\">\"Test Discount Applied\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>And that's it! The test discount will apply 50% to all products if the tag is present on the customer logged in.\nTo avoid overlapping with discount codes inputted you will need to check if the discount code is null or not first.</p>\n<p>Done.</p>\n<p>End State below:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 654px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3d9843d47d6c21bd55a994ffdaaa3feb/ebbc9/endstate.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.22935779816513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABtElEQVQ4y61U2Y7bMAz0///gAkXSLuxYvm/ZumxPh0rTh0USoMUSGFAmpBE5pJzsx4HN7wj7ARt2WOex6DV6sfM88cwk/hWMItmPE6MJ8CQc6FfrMS0axrqXB1/cES1xzsEaA2stnDUIIbwhuuNgVd577rfwrMrzjPDs+45knme0bYtpmtF1HYzZ3pYmJoRaa56ZsLGS1Vgs5JFkEsMPwwzXVXMjqN0RSZdliVm8In9mB+NJPwzoe4Oq6lFWNeq6gcoVsizjukehShSFipKc78R7aNgPY+xonre4XK5I0xQflw+kWYqybBhXxI0XVhjHMWYt5Eb041qqc95FL/FkpHaWne06y7LXCM3yZYOUvhGy3jaut/sh0U8gcenBw0ssadiQpnHwDt9iSd20GCcLVVbIqdUwjZg52L10fenR6g7jOsHyRhc85zW8JBONE1UUKOsOP66/kFGrW8WGNDk+qxRpc8O1+gkll84ay0ZQDtHuKWRscqXYxQV6kcEMcZYe2P8gfMEzMhls8VFDvbJLNkThrT0p7vb3xfyLxZLlRyBP5jssEq4cBUn3Pib/B6ksvmU+td+UHpOp4DwvNgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"End State\"\n        title=\"End State\"\n        src=\"/static/3d9843d47d6c21bd55a994ffdaaa3feb/ebbc9/endstate.png\"\n        srcset=\"/static/3d9843d47d6c21bd55a994ffdaaa3feb/40714/endstate.png 200w,\n/static/3d9843d47d6c21bd55a994ffdaaa3feb/a8246/endstate.png 400w,\n/static/3d9843d47d6c21bd55a994ffdaaa3feb/ebbc9/endstate.png 654w\"\n        sizes=\"(max-width: 654px) 100vw, 654px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","frontmatter":{"path":"/2","title":"Applying discounts based on customer tags in Shopify","excerpt":"Using the Shopify Script Editor","date":"2020-01-10"}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}